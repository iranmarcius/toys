<?xml version="1.0" encoding="utf-8"?>

<project name="BuildBase" xmlns:ivy="antlib:org.apache.ivy.ant">
	<property environment="env"/>
	<property name="dist.dir" value="dist"/>
	<property name="dist.jar" value="${dist.dir}/jars"/>
	<property name="dist.sources" value="${dist.dir}/sources"/>
	<property name="repo.dir.shared" value="//rubi/htdocs/default/ivy/public"/>
	<property name="repo.dir.local" value="${env.USERPROFILE}/.ivy2/cache"/>
	<property name="ivy.settings.file" value="/desenvolvimento/java/eclipse_workspace/toys/ivysettings.xml"/>

	<target name="jarname">
		<ivy:settings file="${ivy.settings.file}"/>
		<ivy:resolve/>
		<property name="jar.name" value="${ivy.module}-${ivy.revision}-jar.jar"/>
		<property name="jar.source" value="${ivy.module}-${ivy.revision}-source.jar"/>
	</target>

	<target name="jarpath">
		<ivy:settings file="${ivy.settings.file}"/>
		<ivy:resolve/>
		<property name="jar.path" value="${repo.dir.shared}/${ivy.organisation}/${ivy.module}"/>
	</target>

	<target name="jar" depends="jarpath, jarname">
		<mkdir dir="${jar.path}"/>
		<delete file="${jar.path}/${jar.name}" failonerror="false"/>
		<jar destfile="${jar.path}/${jar.name}" basedir="bin" includes="**/*.class **/*.properties **/*.xml" excludes="**/test*/**"/>
	</target>

	<target name="publish" depends="jar">
		<copy file="ivy.xml" tofile="${jar.path}/ivy-${ivy.revision}.xml" overwrite="true"/>
		<delete file="${jar.path}/${jar.source}" failonerror="false"/>
		<jar destfile="${jar.path}/${jar.source}" basedir="src" includes="**/*.java **/*.properties **/*.xml"/>

		<!-- Limpa o repositório local para que a nova versão publicada seja recuperada -->
		<delete failonerror="false" verbose="true">
			<fileset dir="${repo.dir.local}/${ivy.organisation}/${ivy.module}" includes="**/*"/>
		</delete>
	</target>

	<target name="resolve">
		<ivy:settings file="../toys/ivysettings.xml"/>
		<ivy:resolve/>
	</target>
</project>